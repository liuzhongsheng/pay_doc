
# 2、签名校验
在对接过程中，所有涉及到签名的地方均参考该方法。本文将详细介绍签名校验的机制，并提供一个 PHP 代码示例，帮助开发人员理解和实现签名校验功能。


## 签名校验机制

签名的生成过程通常包括以下步骤：

1. **数据排序**：将待签名的数据按键名升序排序。
2. **生成查询字符串**：将排序后的数据转换为 URL 查询字符串格式。
3. **添加密钥**：将客服提供的密钥（secretKey）添加到查询字符串的末尾。
4. **计算签名**：使用md5对拼接后的字符串进行计算，生成签名。


## PHP 签名生成示例

以下是一个使用 PHP 实现签名生成的示例代码：

```php
public function generateSignature($orderData, $secretKey) {
    // 将待签名的数据按键名升序排序
    ksort($orderData);

    // 将订单数据数组转换为 URL 查询字符串格式
    $queryString = http_build_query($orderData);

    // 添加商户密钥到查询字符串末尾
    $queryString .= '&' . $secretKey;

    // 使用 MD5 计算签名
    $signature = md5($queryString);

    return $signature;
}
```

## 拼接字符串示例
### 创建订单
```plaintext
merchant_key=商户key&merchant_order_number=订单号&notify_url=http%3A%2F%2Fbaidu.com&payment_amount=100&payment_channel=100&request_time=请求时间&return_url=支付后跳转地址&拼接上密钥
```

### 订单回调
```plaintext
close_time_unix=0&create_time_unix=1716742359&merchant_number=1001&merchant_order_number=SG202405270052390117358&payment_amount=300&payment_status=2&payment_time_unix=1716742432&platform_order_number=&密钥
```

### 查询订单
```plaintext
merchant_key=商户key&order_number=商户订单号&密钥
```